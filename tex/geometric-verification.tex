\section{Geometric verification}
\label{sec:geometric_verification}

After finding possible matchtes for the input image in the database in the feature matching step of the retrieval, it is important to confirm that the locations of the features are geometrically consistent between the input and the result. This is due to the fact that, while depicting the same scene or object, the two images might differ in viewpoint.

\subsection{Location coding}

Location coding is the concept of representating the positions of the extracted features in the input image. It is done after the feature descriptors have been computed, but it is presented here, because the location information is used in the geometric verification step in the image retrieval process.

An efficient method of location coding is to build then compress a histogram of the locations, as presented by Tsai et al.\ in \cite{tsai2010fast}. The authors consider a histogram composed of two pieces which are coded separately: a histogram map and a histogram count.

The histogram map is a subdivision of the image into blocks with binary values. A value of 1 indicates there are features within the boundaries of the block, a value of 0 denotes the lack of features in that area.

The histogram count is the count of features in non emply blocks.

\subsection{Ratio test}

It can happen that a feature detected in the query image is not in the database, because it wasn't detected during the training. Lowe \cite{Lowe04distinctiveimage} provides a method for eliminating those features, called the ratio test.

From the candidate features, let the nearest neighbour to the query feature be the one which descriptor vector is at minimum distance from the query feature's descriptor vector, noted here $d_1$. Let the second-closest neighbour be the closest neighbour (again using Eucledian distance) that comes from a different object, its distance from the the query feature noted $d_2$. Let r be the ratio $r = \frac{d1}{d2}$.

From empirical testing, Lowe has concluded that when the nearest neighbour is a correct match $r$ is distinctly lower than when it is not a correct match. Thus, one can set a threshold ratio and reject matches for which the ratio of distances is larger than the threshold.


\subsection{Random Sample Consensus}
